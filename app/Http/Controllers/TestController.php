<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use App\Models\Test;
use App\Models\Finding;
use App\Models\Project;

class TestController extends Controller
{
    public function index(Project $project, Finding $finding){
        $tests = $finding->tests;
        // dd($tests);
        return view('project.finding.test.index',compact('project', 'finding', 'tests'));
    }

    public function create(Project $project, Finding $finding){
        return view('project.finding.test.create',compact('project', 'finding'));
    }

    public function store(Request $request,Project $project, Finding $finding){

        // dd($request->all());
        $request->validate([
            'main' => 'required',
            'validation' => 'required',
            'feedback_client' => '',
            'additional' => '',
        ]);

        $test = new Test;
        $test->main = $request->input('main');
        $test->validation = $request->input('validation');
        $test->feedback_client = $request->input('feedback_client');
        $test->additional = $request->input('additional');

        $finding->tests()->save($test);

        session()->flash('success', "Detail Finding berhasil ditambahkan!");
        return redirect()->route('test.index', ['project' => $project->id,'finding' => $finding->id]);
    }

    public function destroy(Project $project, Finding $finding, Test $test){
        $test->delete();

        session()->flash('success', "Detail Finding berhasil dihapus");
        return redirect()->route('test.index',['finding' => $finding, 'project' => $project]);
    }
}
